<!DOCTYPE html>

<html class="transitionEnd video">

    <head>

        <link href="css/bootstrap.min.css" rel="stylesheet"/>
        <link href="css/prism.css" rel="stylesheet"/>
        <link href="css/styles.css" rel="stylesheet"/>

                    <title>Nahk: An automation and productivity tool</title>
        
        <script src="js/jquery-1.11.1.min.js"></script>
        <script src="js/bootstrap.min.js"></script>        
        <script src="js/core.js"></script>
        <script src="js/scripts.js"></script>
        <script src="js/components.js"></script>
    </head>

    <body>
        <div class="container">
            <div id="top">
                <div>
                    <a href="index.html"><img alt="Crux Gaming" src="img/Logo.png"/></a>
                </div>                             
                <ul class="nav nav-pills">
                    <li><a href="index.html">Home</a></li>
                    <li role="presentation" class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="bf_dps.php.html#" role="button" aria-haspopup="true" aria-expanded="false">
                            <strong>Games</strong> <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="CRL.html">CRL</a></li>
                            <li><a href="nblocks.php.html">n Blocks</a></li>
                            <li><a href="solitaire.php.html">Lucky Club Solitaire</a></li>
                            <li><a href="zao.php.html">Zao</a></li>
                            <li><a href="spacetime.php.html">Space-Time</a></li>
                        </ul>
                    </li>
                    <li role="presentation" class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="bf_dps.php.html#" role="button" aria-haspopup="true" aria-expanded="false">
                            <strong>Other Projects</strong> <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu">
                            <li><a href="Nahk.html">Nahk: A Productivity Tool</a></li>
                            <li><a href="bf_dps.php.html">BF Team Builder</a></li>
                            <li><a href="dgb.php.html">Disc Golf Buddy</a></li>
                            <li><a href="info.php.html">Info</a></li>
                        </ul>
                    </li>
                </ul>
                                                     
            </div>            
            <div id="middle">


<div class="bs-callout bs-callout-primary" id="callout-inputgroup-container-body">
    <h4>General Details</h4>
    <p>A program designed to give an interface driven way to automate repetitive or visually cued events.</p>
    <p>The user is able to set up keyboard and mouse button combinations that will cause other events to trigger, conditionally or not.
    An example use case, as demoed in the series of screenshots, would be when pressing (Ctrl+S) while in photoshop, check if the canvas is showing at
    a specific screen position, and if so, crop the image and then export as a JPEG.</p>
    <div class="space-normal"></div>
    <h4>Technical Details</h4>
    <p>
        - Written in C# using WinForms.<br>
        - Separation of the Presentation code from the Logic/Business layer.<br>
    </p>

    <div class="Panel-buttons">
        <a href="https://github.com/Zumarok/Nahk" class="Button Button--ghost Panel-button">
            <div class="Button-outer">
                <div class="Button-inner">
                    <div class="Button-label">GitHub</div>
                </div>
            </div>
        </a>
    </div>


</div>
<script src="js/prism.js"></script>
<div class="panel-group" id="accordion">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="Nahk.html#collapse1">
                    Screenshots</a>
            </h4>
        </div>
        <div id="collapse1" class="panel-collapse collapse in">
            <div class="panel-body">

                <div id="myCarousel" class="carousel slide" data-ride="carousel">
                    <!-- Indicators -->
                    <ol class="carousel-indicators">
                        <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
                        <li data-target="#myCarousel" data-slide-to="1"></li>
                        <li data-target="#myCarousel" data-slide-to="2"></li>
                        <li data-target="#myCarousel" data-slide-to="3"></li>
                        <li data-target="#myCarousel" data-slide-to="4"></li>
                        <li data-target="#myCarousel" data-slide-to="5"></li>
                        <li data-target="#myCarousel" data-slide-to="6"></li>
                        <li data-target="#myCarousel" data-slide-to="7"></li>
                        <li data-target="#myCarousel" data-slide-to="8"></li>
                        <li data-target="#myCarousel" data-slide-to="9"></li>
                    </ol>

                    <!-- Wrapper for slides -->
                    <div class="carousel-inner" role="listbox">
                        <div class="item active">
                            <img class="sld_img" src="img/Nahk_1.png" >
                        </div>

                        <div class="item">
                            <img class="sld_img" src="img/Nahk_2.png">
                        </div>

                        <div class="item">
                            <img class="sld_img" src="img/Nahk_3.png" >
                        </div>

                        <div class="item">
                            <img class="sld_img" src="img/Nahk_4.png" >
                        </div>

                        <div class="item">
                            <img class="sld_img" src="img/Nahk_5.png" >
                        </div>

                        <div class="item">
                            <img class="sld_img" src="img/Nahk_6.png" >
                        </div>

                        <div class="item">
                            <img class="sld_img" src="img/Nahk_7.png" >
                        </div>

                        <div class="item">
                            <img class="sld_img" src="img/Nahk_8.png" >
                        </div>

                        <div class="item">
                            <img class="sld_img" src="img/Nahk_9.png" >
                        </div>

                        <div class="item">
                            <img class="sld_img" src="img/Nahk_10.png" >
                        </div>

                    </div>

                    <!-- Left and right controls -->
                    <a class="left carousel-control" href="bf_dps.php.html#myCarousel" role="button" data-slide="prev">
                        <span class="glyphicon glyphicon-chevron-left" aria-hidden="true"></span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="right carousel-control" href="bf_dps.php.html#myCarousel" role="button" data-slide="next">
                        <span class="glyphicon glyphicon-chevron-right" aria-hidden="true"></span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>

            </div>
        </div>
    </div>
    <div id="bootstrap_overrides" class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="Nahk.html#collapse2">
                    Code Example 1</a>
            </h4>
        </div>
        <div id="collapse2" class="panel-collapse collapse">
            <div class="panel-body">
                <pre><code class="language-csharp">
                    using Gma.System.MouseKeyHook;
                    using Nahk.Utils;
                    using Nahk.ViewModels;
                    using NahkLogic.Business;
                    using NahkLogic.Common;

                    namespace Nahk.Forms;

                    /// <summary>
                    /// PauseDialog
                    /// Shows a dialog window with all needed options for a user to set up a pause event.
                    /// </summary>
                    public partial class PauseDialog : Form
                    {
                        public required ProfileViewModel ProfileVM { get; set; }
                        public PauseViewModel PauseVM { get; set; } = new();
                        public PixelCheck PixelCheck { get; set; } = new();
                        public bool IsEditMode { get; set; }
                        public int SelectedIndex { get; set; } = -1;

                        private bool debugPixelInfo = false;


                        public PauseDialog()
                        {
                            InitializeComponent();
                        }

                        private void PauseDialog_Load(object sender, EventArgs e)
                        {
                            Text = IsEditMode ? "Editing Pause Condition" : "New Pause Condition";
                            textBoxWinName.Text = ProfileVM.Model.WindowTitle;
                            SetBindings();
                            SetDataSources();

                            if (comboBoxPixelChecks.Items.Count > 0)
                            {
                                comboBoxPixelChecks.SelectedIndex = 0;
                                PixelCheck = PauseVM.Model.PixelChecks[comboBoxPixelChecks.SelectedIndex];
                                RefreshPixelInfo();
                            }
                        }

                        private void PauseDialog_FormClosed(object sender, FormClosedEventArgs e)
                        {
                            Unsubscribe();
                        }

                        public void Subscribe()
                        {
                            FormMain.Hook.MouseDownExt += MouseHook;
                        }

                        public void Unsubscribe()
                        {
                            FormMain.Hook.MouseDownExt -= MouseHook;
                        }

                        private void SetBindings()
                        {
                            textBoxName.DataBindings.Add("Text", this, "PauseVM.Model.Name", true, DataSourceUpdateMode.OnPropertyChanged);
                            checkBoxEnabled.DataBindings.Add("Checked", this, "PauseVM.Model.Enabled", true, DataSourceUpdateMode.OnPropertyChanged);

                            textBoxPixelCheckName.DataBindings.Add("Text", this, "PixelCheck.Name", true, DataSourceUpdateMode.OnPropertyChanged);
                            textBoxX.DataBindings.Add("Text", this, "PixelCheck.X", true, DataSourceUpdateMode.OnPropertyChanged);
                            textBoxY.DataBindings.Add("Text", this, "PixelCheck.Y", true, DataSourceUpdateMode.OnPropertyChanged);
                            pictureBoxColor.DataBindings.Add("BackColor", this, "PixelCheck.Color", true, DataSourceUpdateMode.OnPropertyChanged);
                            checkBoxOnFound.DataBindings.Add("Checked", this, "PixelCheck.OnFound", true, DataSourceUpdateMode.OnPropertyChanged);
                        }

                        private void SetDataSources()
                        {
                            comboBoxPixelChecks.DataSource = null;
                            comboBoxPixelChecks.DataSource = PauseVM.Model.PixelChecks;
                            comboBoxPixelChecks.DisplayMember = "Name";
                            groupBoxPixelCheck.Enabled = comboBoxPixelChecks.Items.Count > 0;
                        }

                        private void buttonOk_Click(object sender, EventArgs e)
                        {
                            if (ProfileValidation.ValidatePause(ProfileVM.Model, PauseVM.Model, IsEditMode))
                            {
                                DialogResult = DialogResult.OK;
                            }
                            errorProvider.SetError(buttonOk, ProfileValidation.ErrorMessage);
                        }

                        private void buttonDelete_Click(object sender, EventArgs e)
                        {
                            var result = MessageBox.Show("Delete this Pause Condition?", "Delete Pause Condition", MessageBoxButtons.YesNo, MessageBoxIcon.Question);

                            if (result != DialogResult.Yes || SelectedIndex == -1) return;

                            ProfileVM.Model.PauseList.RemoveAt(SelectedIndex);
                            DialogResult = DialogResult.Cancel;
                        }

                        private void buttonPixelInfo_Click(object sender, EventArgs e)
                        {
                            var hWnd = Nhk.GetWindowHandle(ProfileVM.Model.WindowTitle);
                            if (hWnd == IntPtr.Zero)
                            {
                                textBoxWinName.Text = "Window not found...";
                                return;
                            }
                            Subscribe();
                            debugPixelInfo = true;
                            Task.Run(() => GetPixelInfo(hWnd));
                        }

                        private async Task GetPixelInfo(IntPtr hWnd)
                        {
                            while (debugPixelInfo)
                            {
                                Invoke((MethodInvoker)Inv);
                                await Task.Delay(200);
                                continue;

                                void Inv()
                                {
                                    var screenPoint = new Point(Cursor.Position.X, Cursor.Position.Y);
                                    var wndPoint = Nhk.ScreenToWindowPoint(hWnd, screenPoint);
                                    Nhk.CaptureWindowBmp(hWnd);
                                    var color = Nhk.GetBmpPixel(wndPoint);
                                    textBoxX.Text = $"{wndPoint.X}";
                                    textBoxY.Text = $"{wndPoint.Y}";
                                    if (color != null)
                                    {
                                        pictureBoxColor.BackColor = (Color)color;
                                    }
                                }
                            }
                        }

                        private void MouseHook(object? sender, MouseEventExtArgs e)
                        {
                            if (e.Button == MouseButtons.Right)
                            {
                                e.Handled = true;
                                debugPixelInfo = false;
                            }
                        }

                        private void textBoxName_Validating(object sender, System.ComponentModel.CancelEventArgs e)
                        {
                            if (!ProfileValidation.ValidatePauseName(ProfileVM.Model, textBoxName.Text, IsEditMode))
                            {
                                e.Cancel = true;
                                textBoxName.SelectAll();
                            }
                            errorProvider.SetError(buttonOk, ProfileValidation.ErrorMessage);
                        }

                        private void comboBoxPixelChecks_SelectionChangeCommitted(object sender, EventArgs e)
                        {
                            if (comboBoxPixelChecks.SelectedIndex < 0) return;
                            PixelCheck = PauseVM.Model.PixelChecks[comboBoxPixelChecks.SelectedIndex];
                            RefreshPixelInfo();
                        }

                        private void buttonAddPixelCheck_Click(object sender, EventArgs e)
                        {
                            PixelCheck = new PixelCheck();
                            PauseVM.Model.PixelChecks.Add(PixelCheck);
                            SetDataSources();
                            RefreshPixelInfo();
                        }

                        private void buttonDeletePixelCheck_Click(object sender, EventArgs e)
                        {
                            PauseVM.Model.PixelChecks.Remove(PixelCheck);
                            SetDataSources();

                            if (comboBoxPixelChecks.Items.Count <= 0) return;

                            comboBoxPixelChecks.SelectedIndex = comboBoxPixelChecks.Items.Count - 1;
                            PixelCheck = PauseVM.Model.PixelChecks[comboBoxPixelChecks.SelectedIndex];
                            RefreshPixelInfo();
                        }

                        private void RefreshPixelInfo()
                        {
                            textBoxPixelCheckName.BindingContext = new BindingContext();
                            textBoxX.BindingContext = new BindingContext();
                            textBoxY.BindingContext = new BindingContext();
                            pictureBoxColor.BindingContext = new BindingContext();
                            checkBoxOnFound.BindingContext = new BindingContext();
                        }

                        private void PauseDialog_FormClosing(object sender, FormClosingEventArgs e)
                        {
                            debugPixelInfo = false;
                        }
                    }

                    </code></pre>
            </div>
        </div>
    </div>
    <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="Nahk.html#collapse3">
                    Code Example 2</a>
            </h4>
        </div>
        <div id="collapse3" class="panel-collapse collapse">
            <div class="panel-body">
                <pre><code class="language-csharp">
                    using System.ComponentModel;
                    using System.Runtime.CompilerServices;
                    using NahkLogic.Common;

                    namespace Nahk.ViewModels;

                    /// <summary>
                    /// Base class for all ViewModel classes
                    /// </summary>
                    public class ViewModelBase<T> : INotifyPropertyChanged where T : new()
                    {
                        public event PropertyChangedEventHandler? PropertyChanged;

                        private string xml = string.Empty;
                        private T model = new();
                        public T Model
                        {
                            get => model;
                            set
                            {
                                if (value == null) return;

                                xml = value.XmlSerializeToString();
                                model = xml.XmlDeserializeFromString<T>() ?? new T();
                                OnPropertyChanged();
                            }
                        }

                        public void RefreshDisplay() => OnPropertyChanged(nameof(Model));

                        public bool HasChangedSinceLoad() => model != null && model.XmlSerializeToString() != xml;

                        protected void OnPropertyChanged([CallerMemberName] string propertyName = "")
                        {
                            PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));
                        }
                    }
                </code></pre>
            </div>
        </div>
    </div> <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="Nahk.html#collapse4">
                    Code Example 3</a>
            </h4>
        </div>
        <div id="collapse4" class="panel-collapse collapse">
            <div class="panel-body">

                <pre><code class="language-csharp">
                using System.Xml.Serialization;
                using Microsoft.VisualBasic.FileIO;
                using NahkLogic.Common;

                namespace NahkLogic.Data;

                /// <summary>
                /// ProfileRepository
                /// Provides a singular point for all verification of profile data.
                /// </summary>
                internal class ProfileRepository
                {
                    public static List<string> GetProfileNames(bool lower = false)
                    {
                        if (!Directory.Exists(Config.SavedProfileDirectory))
                        {
                            Directory.CreateDirectory(Config.SavedProfileDirectory);
                        }

                        List<string> files;
                        if (lower)
                        {
                            files = Directory.GetFiles(Config.SavedProfileDirectory, "*" + Config.FileExtension).Select(f => f.Split('\\').Last().ToLower()).ToList();
                        }

                        files = Directory.GetFiles(Config.SavedProfileDirectory, "*" + Config.FileExtension).Select(f => f.Split('\\').Last()).ToList();
                        files.Remove(Config.SettingsFileName + Config.FileExtension);
                        return files;
                    }

                    public static int SaveProfile(Profile profile)
                    {
                        try
                        {
                            if (!Directory.Exists(Config.SavedProfileDirectory))
                            {
                                Directory.CreateDirectory(Config.SavedProfileDirectory);
                            }
                            var serializer = new XmlSerializer(typeof(Profile));
                            using StreamWriter writer = new(Config.SavedProfileDirectory + profile.ProfileName + Config.FileExtension);
                            serializer.Serialize(writer, profile);
                        }
                        catch (Exception e)
                        {
                            return -1;
                        }

                        return 0;
                    }

                    public static Profile? LoadProfile(string name)
                    {
                        var serializer = new XmlSerializer(typeof(Profile));
                        using StreamReader reader = new(Config.SavedProfileDirectory + name);
                        return serializer.Deserialize(reader) as Profile ?? new Profile();
                    }

                    public static void DeleteProfile(Profile profile)
                    {
                        FileSystem.DeleteFile(Config.SavedProfileDirectory + profile.ProfileName + Config.FileExtension, UIOption.OnlyErrorDialogs, RecycleOption.SendToRecycleBin);
                    }
                }
                </code></pre>
            </div>
        </div>
    </div>
</div>
            </div>

            <div id="bottom">
                Copyright &#169; Nicholus Huber / Crux Gaming
            </div>

        </div>

    </body>

</html>
